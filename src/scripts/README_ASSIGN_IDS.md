# Инструкция по использованию скрипта assignParticipantIds.js

## Что делает скрипт

Этот скрипт автоматически:
1. Находит пользователей по email в Firebase коллекции `registrations`
2. Генерирует для них уникальный participantId в формате `APO-2025-XXXXX`
3. Обновляет записи в Firebase, добавляя поле `participantId`
4. Отправляет каждому пользователю email с его номером участника

## Подготовка

### 1. Убедитесь, что у вас есть файл `.env` в корне проекта со следующими переменными:

```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=465
SMTP_USER=ваш-email@gmail.com
SMTP_PASSWORD=ваш-пароль-приложения
SMTP_FROM=ваш-email@gmail.com
```

**Важно:** Для Gmail используйте "Пароль приложения", а не обычный пароль:
- Перейдите в настройки Google аккаунта
- Безопасность → Двухэтапная аутентификация → Пароли приложений
- Создайте новый пароль приложения для "Почта"

### 2. Список email для обработки

Скрипт обработает следующие email (они уже указаны в коде):
- violetta121109@gmail.com
- athufycrbq3rjym@yandex.ru
- klimyarkov@gmail.com
- artm.panyushin07@mail.ru
- edem.samara@mail.ru
- ekaterinapiter08@mail.ru
- makotorejka@gmail.com
- slychkova092206@mail.ru

Если нужно изменить список, отредактируйте массив `emailsToUpdate` в файле `src/scripts/assignParticipantIds.js`.

## Запуск скрипта

Выполните команду в терминале:

```bash
npm run assign-ids
```

## Что происходит при запуске

Для каждого email скрипт:

1. **Ищет пользователя** в Firebase по email
   - Если не найден → выводит ошибку и переходит к следующему
   - Если найдено несколько записей → обрабатывает первую

2. **Проверяет наличие participantId**
   - Если уже есть → отправляет email с существующим ID
   - Если нет → генерирует новый ID

3. **Обновляет Firebase** (только если ID не было)
   - Добавляет поле `participantId`
   - Обновляет `updatedAt`

4. **Отправляет email** с красивым шаблоном, содержащим:
   - Номер участника (participantId)
   - ФИО пользователя
   - Email, школу, класс
   - Выбранные предметы

## Отчет

После завершения скрипт выведет итоговый отчет:

```
=== ИТОГОВЫЙ ОТЧЕТ ===

✅ Успешно обработано: 8
  - violetta121109@gmail.com: APO-2025-00123 (Создан новый ID и отправлен email)
  - ...

❌ Ошибки: 0
```

## Устранение проблем

### "Пользователь не найден в базе"
- Проверьте, что email написан правильно
- Проверьте, что пользователь действительно есть в Firebase коллекции `registrations`

### "SMTP connection failed"
- Проверьте правильность переменных окружения в `.env`
- Убедитесь, что используете пароль приложения для Gmail
- Проверьте интернет-соединение

### "Firebase error"
- Убедитесь, что у вас есть права доступа к Firebase
- Проверьте настройки Firebase в `src/lib/firebase.js`

## Повторный запуск

Скрипт можно запускать несколько раз. Если у пользователя уже есть participantId, скрипт:
- НЕ изменит существующий ID
- Просто отправит email с текущим ID
- Это безопасно и не создаст дубликаты

## Результат

После успешного выполнения:
- ✅ В Firebase у каждого пользователя появится поле `participantId`
- ✅ Каждый пользователь получит email с его номером участника
- ✅ Скрипт выведет подробный отчет о выполнении

